<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-client-guide">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Uniffle Shuffle Client Guide | Apache Uniffle (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://uniffle.apache.org/zh-CN/docs/client-guide"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Uniffle Shuffle Client Guide | Apache Uniffle (Incubating)"><meta data-rh="true" name="description" content="Uniffle is designed as a unified shuffle engine for multiple computing frameworks, including Apache Spark and Apache Hadoop."><meta data-rh="true" property="og:description" content="Uniffle is designed as a unified shuffle engine for multiple computing frameworks, including Apache Spark and Apache Hadoop."><link data-rh="true" rel="icon" href="/zh-CN/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://uniffle.apache.org/zh-CN/docs/client-guide"><link data-rh="true" rel="alternate" href="https://uniffle.apache.org/docs/client-guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://uniffle.apache.org/zh-CN/docs/client-guide" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://uniffle.apache.org/docs/client-guide" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Apache Uniffle (Incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Apache Uniffle (Incubating) Atom Feed"><link rel="stylesheet" href="/zh-CN/assets/css/styles.c92a85d1.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.7ad959ae.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.71cbb515.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/img/uniffle-logo.png" alt="Apache Uniffle (Incubating)" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-CN/img/uniffle-logo.png" alt="Apache Uniffle (Incubating)" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Apache Uniffle (Incubating)</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-CN/docs/intro">文档</a><a class="navbar__item navbar__link" href="/zh-CN/community/how to contribute">社区</a><a class="navbar__item navbar__link" href="/zh-CN/blog">博客</a><a class="navbar__item navbar__link" href="/zh-CN/download">下载</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">基金会</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">许可证</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">事件</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">安全</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">赞助</a></li><li><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">隐私</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">感谢</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/client-guide" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-CN/docs/client-guide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">简体中文</a></li></ul></div><a href="https://github.com/apache/incubator-uniffle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/intro">介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zh-CN/docs/client-guide">Uniffle Shuffle Client Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/Deploy/coordinator-guide">Deploy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/K8s-Operator/uniffle-operator-design">K8s-Operator</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/configuration">Uniffle Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/build">Build Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/tuning">Tuning Uniffle</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Uniffle Shuffle Client Guide</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Uniffle Shuffle Client Guide</h1><p>Uniffle is designed as a unified shuffle engine for multiple computing frameworks, including Apache Spark and Apache Hadoop.
Uniffle has provided pluggable client plugins to enable remote shuffle in Spark and MapReduce.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy">Deploy<a href="#deploy" class="hash-link" aria-label="Deploy的直接链接" title="Deploy的直接链接">​</a></h2><p>This document will introduce how to deploy Uniffle client plugins with Spark and MapReduce.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-spark-client-plugin">Deploy Spark Client Plugin<a href="#deploy-spark-client-plugin" class="hash-link" aria-label="Deploy Spark Client Plugin的直接链接" title="Deploy Spark Client Plugin的直接链接">​</a></h3><ol><li><p>Add client jar to Spark classpath, eg, SPARK_HOME/jars/</p><p>The jar for Spark2 is located in &lt;RSS_HOME&gt;/jars/client/spark2/rss-client-XXXXX-shaded.jar</p><p>The jar for Spark3 is located in &lt;RSS_HOME&gt;/jars/client/spark3/rss-client-XXXXX-shaded.jar</p></li><li><p>Update Spark conf to enable Uniffle, eg,</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark.shuffle.manager org.apache.spark.shuffle.RssShuffleManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.coordinator.quorum &lt;coordinatorIp1&gt;:19999,&lt;coordinatorIp2&gt;:19999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Note: For Spark2, spark.sql.adaptive.enabled should be false because Spark2 doesn&#x27;t support AQE.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="support-spark-dynamic-allocation">Support Spark Dynamic Allocation<a href="#support-spark-dynamic-allocation" class="hash-link" aria-label="Support Spark Dynamic Allocation的直接链接" title="Support Spark Dynamic Allocation的直接链接">​</a></h3><p>To support spark dynamic allocation with Uniffle, spark code should be updated.
There are 7 patches for spark (2.3.4/2.4.6/3.0.1/3.1.2/3.2.1/3.3.1/3.4.1) in patch/spark folder for reference.</p><p>After apply the patch and rebuild spark, add following configuration in spark conf to enable dynamic allocation:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark.shuffle.service.enabled false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.dynamicAllocation.enabled true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For spark3.5 or above just add one more configuration:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark.shuffle.sort.io.plugin.class org.apache.spark.shuffle.RssShuffleDataIo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-mapreduce-client-plugin">Deploy MapReduce Client Plugin<a href="#deploy-mapreduce-client-plugin" class="hash-link" aria-label="Deploy MapReduce Client Plugin的直接链接" title="Deploy MapReduce Client Plugin的直接链接">​</a></h3><ol><li>Add client jar to the classpath of each NodeManager, e.g., &lt;HADOOP_HOME&gt;/share/hadoop/mapreduce/</li></ol><p>The jar for MapReduce is located in &lt;RSS_HOME&gt;/jars/client/mr/rss-client-mr-XXXXX-shaded.jar</p><ol start="2"><li><p>Update MapReduce conf to enable Uniffle, eg,</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-Dmapreduce.rss.coordinator.quorum=&lt;coordinatorIp1&gt;:19999,&lt;coordinatorIp2&gt;:19999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-Dyarn.app.mapreduce.am.command-opts=org.apache.hadoop.mapreduce.v2.app.RssMRAppMaster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-Dmapreduce.job.map.output.collector.class=org.apache.hadoop.mapred.RssMapOutputCollector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-Dmapreduce.job.reduce.shuffle.consumer.plugin.class=org.apache.hadoop.mapreduce.task.reduce.RssShuffle</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the RssMRAppMaster will automatically disable slow start (i.e., <code>mapreduce.job.reduce.slowstart.completedmaps=1</code>)
and job recovery (i.e., <code>yarn.app.mapreduce.am.job.recovery.enable=false</code>)</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Configuration的直接链接" title="Configuration的直接链接">​</a></h2><p>The important configuration of client is listed as following.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-setting">Common Setting<a href="#common-setting" class="hash-link" aria-label="Common Setting的直接链接" title="Common Setting的直接链接">​</a></h3><p>These configurations are shared by all types of clients.</p><table><thead><tr><th>Property Name</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>&lt;client_type&gt;.rss.coordinator.quorum</td><td>-</td><td>Coordinator quorum</td></tr><tr><td>&lt;client_type&gt;.rss.writer.buffer.size</td><td>3m</td><td>Buffer size for single partition data</td></tr><tr><td>&lt;client_type&gt;.rss.storage.type</td><td>-</td><td>Supports MEMORY_LOCALFILE, MEMORY_HDFS, MEMORY_LOCALFILE_HDFS</td></tr><tr><td>&lt;client_type&gt;.rss.client.read.buffer.size</td><td>14m</td><td>The max data size read from storage</td></tr><tr><td>&lt;client_type&gt;.rss.client.send.threadPool.size</td><td>5</td><td>The thread size for send shuffle data to shuffle server</td></tr><tr><td>&lt;client_type&gt;.rss.client.assignment.tags</td><td>-</td><td>The comma-separated list of tags for deciding assignment shuffle servers. Notice that the SHUFFLE_SERVER_VERSION will always as the assignment tag whether this conf is set or not</td></tr><tr><td>&lt;client_type&gt;.rss.client.data.commit.pool.size</td><td>The number of assigned shuffle servers</td><td>The thread size for sending commit to shuffle servers</td></tr><tr><td>&lt;client_type&gt;.rss.client.assignment.shuffle.nodes.max</td><td>-1</td><td>The number of required assignment shuffle servers. If it is less than 0 or equals to 0 or greater than the coordinator&#x27;s config of &quot;rss.coordinator.shuffle.nodes.max&quot;, it will use the size of &quot;rss.coordinator.shuffle.nodes.max&quot; default</td></tr></tbody></table><p>Notice:</p><ol><li><p><code>&lt;client_type&gt;</code> should be <code>spark</code> or <code>mapreduce</code></p></li><li><p><code>&lt;client_type&gt;.rss.coordinator.quorum</code> is compulsory, and other configurations are optional when coordinator dynamic configuration is enabled.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adaptive-remote-shuffle-enabling">Adaptive Remote Shuffle Enabling<a href="#adaptive-remote-shuffle-enabling" class="hash-link" aria-label="Adaptive Remote Shuffle Enabling的直接链接" title="Adaptive Remote Shuffle Enabling的直接链接">​</a></h3><p>To select build-in shuffle or remote shuffle in a smart manner, Uniffle support adaptive enabling.
The client should use <code>DelegationRssShuffleManager</code> and provide its unique &lt;access_id&gt; so that the coordinator could distinguish whether it should enable remote shuffle.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark.shuffle.manager org.apache.spark.shuffle.DelegationRssShuffleManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.access.id=&lt;access_id&gt; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice:
Currently, this feature only supports Spark.</p><p>Other configuration:</p><table><thead><tr><th>Property Name</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>spark.rss.access.timeout.ms</td><td>10000</td><td>The timeout to access Uniffle coordinator</td></tr><tr><td>spark.rss.client.access.retry.interval.ms</td><td>20000</td><td>The interval between retries fallback to SortShuffleManager</td></tr><tr><td>spark.rss.client.access.retry.times</td><td>0</td><td>The number of retries fallback to SortShuffleManager</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="client-quorum-setting">Client Quorum Setting<a href="#client-quorum-setting" class="hash-link" aria-label="Client Quorum Setting的直接链接" title="Client Quorum Setting的直接链接">​</a></h3><p>Uniffle supports client-side quorum protocol to tolerant shuffle server crash.
This feature is client-side behaviour, in which shuffle writer sends each block to multiple servers, and shuffle readers could fetch block data from one of server.
Since sending multiple replicas of blocks can reduce the shuffle performance and resource consumption, we designed it as an optional feature.</p><table><thead><tr><th>Property Name</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>&lt;client_type&gt;.rss.data.replica</td><td>1</td><td>The max server number that each block can be send by client in quorum protocol</td></tr><tr><td>&lt;client_type&gt;.rss.data.replica.write</td><td>1</td><td>The min server number that each block should be send by client successfully</td></tr><tr><td>&lt;client_type&gt;.rss.data.replica.read</td><td>1</td><td>The min server number that metadata should be fetched by client successfully</td></tr></tbody></table><p>Notice:</p><ol><li><code>spark.rss.data.replica.write</code> + <code>spark.rss.data.replica.read</code> &gt; <code>spark.rss.data.replica</code></li></ol><p>Recommended examples:</p><ol><li>Performance First (default)</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.data.replica 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.data.replica.write 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.data.replica.read 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Fault-tolerant First</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.data.replica 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.data.replica.write 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.rss.data.replica.read 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="spark-specialized-setting">Spark Specialized Setting<a href="#spark-specialized-setting" class="hash-link" aria-label="Spark Specialized Setting的直接链接" title="Spark Specialized Setting的直接链接">​</a></h3><p>The important configuration is listed as following.</p><table><thead><tr><th>Property Name</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>spark.rss.writer.buffer.spill.size</td><td>128m</td><td>Buffer size for total partition data</td></tr><tr><td>spark.rss.client.send.size.limit</td><td>16m</td><td>The max data size sent to shuffle server</td></tr><tr><td>spark.rss.client.unregister.thread.pool.size</td><td>10</td><td>The max size of thread pool of unregistering</td></tr><tr><td>spark.rss.client.unregister.request.timeout.sec</td><td>10</td><td>The max timeout sec when doing unregister to remote shuffle-servers</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapreduce-specialized-setting">MapReduce Specialized Setting<a href="#mapreduce-specialized-setting" class="hash-link" aria-label="MapReduce Specialized Setting的直接链接" title="MapReduce Specialized Setting的直接链接">​</a></h3><table><thead><tr><th>Property Name</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>mapreduce.rss.client.max.buffer.size</td><td>3k</td><td>The max buffer size in map side</td></tr><tr><td>mapreduce.rss.client.batch.trigger.num</td><td>50</td><td>The max batch of buffers to send data in map side</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="remote-spill-experimental">Remote Spill (Experimental)<a href="#remote-spill-experimental" class="hash-link" aria-label="Remote Spill (Experimental)的直接链接" title="Remote Spill (Experimental)的直接链接">​</a></h3><p>In cloud environment, VM may have very limited disk space and performance.
This experimental feature allows reduce tasks to spill data to remote storage (e.g., hdfs)</p><table><thead><tr><th>Property Name</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>mapreduce.rss.reduce.remote.spill.enable</td><td>false</td><td>Whether to use remote spill</td></tr><tr><td>mapreduce.rss.reduce.remote.spill.attempt.inc</td><td>1</td><td>Increase reduce attempts as hdfs is easier to crash than disk</td></tr><tr><td>mapreduce.rss.reduce.remote.spill.replication</td><td>1</td><td>The replication number to spill data to hdfs</td></tr><tr><td>mapreduce.rss.reduce.remote.spill.retries</td><td>5</td><td>The retry number to spill data to hdfs</td></tr></tbody></table><p>Notice: this feature requires the MEMORY_LOCAL_HDFS mode.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/incubator-uniffle/docs/02-client-guide.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>zhengchenyu</b> <!-- -->于 <b><time datetime="2025-01-09T03:08:32.000Z">2025年1月9日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-CN/docs/intro"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">介绍</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-CN/docs/Deploy/coordinator-guide"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Uniffle Coordinator Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deploy" class="table-of-contents__link toc-highlight">Deploy</a><ul><li><a href="#deploy-spark-client-plugin" class="table-of-contents__link toc-highlight">Deploy Spark Client Plugin</a></li><li><a href="#support-spark-dynamic-allocation" class="table-of-contents__link toc-highlight">Support Spark Dynamic Allocation</a></li><li><a href="#deploy-mapreduce-client-plugin" class="table-of-contents__link toc-highlight">Deploy MapReduce Client Plugin</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#common-setting" class="table-of-contents__link toc-highlight">Common Setting</a></li><li><a href="#adaptive-remote-shuffle-enabling" class="table-of-contents__link toc-highlight">Adaptive Remote Shuffle Enabling</a></li><li><a href="#client-quorum-setting" class="table-of-contents__link toc-highlight">Client Quorum Setting</a></li><li><a href="#spark-specialized-setting" class="table-of-contents__link toc-highlight">Spark Specialized Setting</a></li><li><a href="#mapreduce-specialized-setting" class="table-of-contents__link toc-highlight">MapReduce Specialized Setting</a></li><li><a href="#remote-spill-experimental" class="table-of-contents__link toc-highlight">Remote Spill (Experimental)</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/intro">开始文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/the-asf/shared_invite/zt-1fm9561yr-uzTpjqg3jf5nxSJV5AE3KQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/incubator-uniffle/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">问题跟踪<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/incubator-uniffle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/zh-CN/img/apache-incubator.svg" alt="Apache Incubator logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/zh-CN/img/apache-incubator.svg" alt="Apache Incubator logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright"><div style="text-align: left;">
          <div>
            <p style="font-family: Avenir-Medium;font-size: 14px;color: #999;line-height: 20px;"> Apache Uniffle (Incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF. </p>
          </div>
          <div style="border-top: 1px solid #ccc;min-height: 60px;line-height: 20px;text-align: center;font-family: Avenir-Medium;font-size: 14px;color: #999;display: flex;align-items: center;"><span>Copyright © 2025 The Apache Software Foundation. Apache Uniffle (Incubating), Uniffle, and its feather logo are trademarks of The Apache Software Foundation.</span></div>
        </div></div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.7ad959ae.js"></script>
<script src="/zh-CN/assets/js/main.71cbb515.js"></script>
</body>
</html>